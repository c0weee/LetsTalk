import{b as B,f as H,a as G,s as J,_ as O}from"./format-VSbp8lJM.js";import{s as L,a as W}from"./index-BVqgPIqZ.js";import{o as s,c as d,p as e,d as I,t as f,q as w,b as i,C as K,D as Q,l as R,E as x,G as X,r as Y,e as m,H as Z,v as C,F as q,j as ee,k as te,w as P,x as ae,z as y,h as se,A as oe,I as ne,J as le,u as ie,a as ce}from"./index-DX4UmDNc.js";import{s as re}from"./index-CLmEgjDY.js";const de={class:"flex"},ue={class:"ml-5 w-full"},pe={class:"flex bg-rose-50 px-1"},me={class:"ml-5"},ve={__name:"PostItem",props:{post:{type:Object,required:!0}},setup(n){return(o,b)=>{const c=L;return s(),d("div",de,[e("div",null,[n.post.avatar?(s(),I(c,{key:0,class:"p-overlay-badge border",image:n.post.avatar,size:"large"},null,8,["image"])):(s(),I(c,{key:1,class:"p-overlay-badge",icon:"pi pi-user",size:"large"}))]),e("div",ue,[e("div",pe,[e("div",null,f(n.post.createdBy),1),e("div",me,f(n.post.createdAt?w(H)(n.post.createdAt,"yyyy-MM-dd HH:mm"):""),1)]),e("div",null,f(n.post.content),1)])])}}},_e=B(ve,[["__scopeId","data-v-ab272f8c"]]),he={class:"font-medium text-xl mb-3"},fe={class:"flex mb-3"},ge={class:"ml-5 w-full flex justify-between"},ye={class:"flex"},be={__name:"ThreadItem",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(n){const o=i(!1),b=i(!1),c=i(null),v=i(null),l=K(n,"modelValue"),_=i(l),r=async()=>{if(await x(),c.value&&v.value){const $=c.value.scrollHeight,h=v.value.scrollHeight;b.value=h>$}},u=()=>{o.value=!o.value,x(r)},g=Q(()=>({maxHeight:o.value?"none":"100px",overflow:"hidden",transition:"max-height 0.3s ease"}));return R(o,()=>{x(r)}),R(_,()=>{x(r)}),X(()=>{x(r)}),(k,$)=>{const h=L;return s(),d(q,null,[e("div",he,f(l.value.title),1),e("div",fe,[e("div",null,[l.value.avatar?(s(),I(h,{key:0,class:"p-overlay-badge border",size:"large",image:l.value.avatar},null,8,["image"])):(s(),I(h,{key:1,class:"p-overlay-badge",icon:"pi pi-user",size:"large"}))]),e("div",ge,[e("div",null,[e("div",null," Created By: "+f(l.value.username),1),e("div",null,f(l.value.updatedAt?w(H)(l.value.updatedAt,"yyyy-MM-dd HH:mm"):""),1)]),e("div",null,[Y(k.$slots,"buttons",{},void 0,!0)])])]),e("div",ye,[e("div",null,[m(h,{class:"p-overlay-badge invisible",icon:"pi pi-user",size:"large"})]),e("div",{class:"ml-5 container",ref_key:"containerRef",ref:c},[e("div",{style:Z(g.value)},[e("p",{ref_key:"contentRef",ref:v},f(l.value.content),513)],4),b.value?(s(),d("button",{key:0,onClick:u,class:"w-full p-2"}," Show More ")):C("",!0)],512)])],64)}}},ke=B(be,[["__scopeId","data-v-3882d31f"]]),A=n=>(ne("data-v-e807bd4f"),n=n(),le(),n),xe={key:0,class:"absolute-center text-2xl"},we={key:1},Ie=A(()=>e("div",{class:"text-base font-medium"},"Replies",-1)),$e={key:0,class:"mb-5"},Ve={key:1,class:"mt-5"},Se=["onClick"],Te={class:"footer"},Pe={key:2},Re=A(()=>e("div",{class:"font-medium text-lg mb-3"},"New Post",-1)),Ce={__name:"ThreadView",setup(n){const o=ie(),b=ce(),c=ee(),v=te(),l=i(!0),_=i(!1),r=i({}),u=i([]),g=i(),k=i(),$=t=>{const a=new URLSearchParams;return t.id&&a.append("id",t.id),t.page&&a.append("page",t.page),a.toString()},h=async t=>{try{const a=$(t),[S,V]=await Promise.all([y.get(`thread/getById?id=${t.id}`),y.get(`post/getByThreadId?${a}`)]);if(r.value=S.data,u.value=V.data,c.isLogin){const T=await y.get(`thread/isLikeByUserId?id=${t.id}`);_.value=T.data}}catch(a){console.error("Failed to fetch data:",err),v.error(a)}finally{l.value=!1}},M=async()=>{try{const t=await y.post("post/create",{threadId:o.params.id,content:g.value,parentId:k.value||null});if(u.value.count++,g.value="",u.value.count>50){const a=(parseInt(o.query.page)||1)+1;b.replace({query:{...o.query,page:a}})}else u.value.posts.push(t.data)}catch(t){console.log(t),v.error(t)}},z=t=>{k.value=t},D=async()=>{try{let t;_.value?t=await y.delete("thread/deleteLike",{data:{threadId:o.params.id}}):t=await y.post("thread/addLike",{threadId:o.params.id}),_.value=!_.value,v.success(t.data.message)}catch(t){console.log("Failed to fetch data:",t),v.error(t)}};return R(()=>({id:o.params.id,page:o.query.page}),h,{immediate:!0}),(t,a)=>{const S=W,V=se,T=O,N=ke,U=re,F=_e,j=G,E=J;return l.value?(s(),d("div",xe,[m(S,{style:{width:"50px",height:"50px"},strokeWidth:"8",fill:"transparent",animationDuration:".5s"})])):(s(),d("div",we,[m(N,{modelValue:r.value,"onUpdate:modelValue":a[1]||(a[1]=p=>r.value=p)},{buttons:P(()=>[w(c).isLogin?(s(),I(V,{key:0,onClick:D,icon:_.value?"pi pi-thumbs-up-fill":"pi pi-thumbs-up",severity:"secondary",class:"text-sm font-thin ml-1"},null,8,["icon"])):C("",!0),m(T,{isNew:!1,modelValue:r.value,"onUpdate:modelValue":a[0]||(a[0]=p=>r.value=p)},null,8,["modelValue"])]),_:1},8,["modelValue"]),Ie,m(U),u.value.count==0?(s(),d("div",$e," No Post found! ")):(s(),d("div",Ve,[e("ul",null,[(s(!0),d(q,null,ae(u.value.posts,p=>(s(),d("li",{class:"mb-10",key:p.id},[m(F,{post:p},{button:P(()=>[e("button",{onClick:Be=>z(p.id)},"Reply",8,Se)]),_:2},1032,["post"])]))),128))]),e("div",Te,[m(j,{count:u.value.count,page:parseInt(w(o).query.page)||1},null,8,["count","page"])])])),w(c).isLogin?(s(),d("div",Pe,[Re,m(E,{modelValue:g.value,"onUpdate:modelValue":a[2]||(a[2]=p=>g.value=p),style:{height:"240px"},class:"w-full mb-3"},null,8,["modelValue"]),m(V,{onClick:M},{default:P(()=>[oe("Submit")]),_:1})])):C("",!0)]))}}},Me=B(Ce,[["__scopeId","data-v-e807bd4f"]]);export{Me as default};
